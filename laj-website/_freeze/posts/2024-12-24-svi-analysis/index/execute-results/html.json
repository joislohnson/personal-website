{
  "hash": "015f53d2f48c5630845956b73dcf645b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Wake County SVI Analysis\"\n# description: \"blog post description (appears underneath the title in smaller text) which is included on the listing page\"\nauthor:\n  - name: Lois Adler-Johnson\n  #  url: \n  #  orcid: 0000-0002-0959-1703\ndate: 12-24-2024\ncategories: [Quarto, R, Mapping] # self-defined categories\nformat: \n  html:\n   code-fold: true\ntoc: true\n# citation: \n#   url: \n#image: preview-image.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready\n---\n\n\n\n# Overview\n\nI recently investigated a subset of [Social Vulnerability Index (SVI) data from CDC/ATSDR](https://www.atsdr.cdc.gov/place-health/php/svi/index.html) for Wake County, NC. I'm working on building my mapping skills in R, so this project felt like a great opportunity to play around with the [tigris](https://github.com/walkerke/tigris) and [sf](https://r-spatial.github.io/sf/) packages.\n\n# Load Libraries\n\nLoad necessary packages to use functions throughout the document.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) # data wrangling\nlibrary(janitor) # clean up\nlibrary(labelled) # variable labels\nlibrary(scales) # scaling functions for visualization\nlibrary(openxlsx) # xslx reading\nlibrary(expss) # labels\nlibrary(sf) # mapping\nlibrary(tidycensus) # for using Census data\nlibrary(tigris) # download TIGER/Line shapefiles from Census\nlibrary(ggmap) # spatial viz\nlibrary(ggthemes) # ggplot themes\nlibrary(GGally) # ggplot2 extension\nlibrary(grateful) # package citations\nlibrary(knitr)\n```\n:::\n\n\n\n# Import Data\n\nAfter importing the file, I filtered the data to Wake County, NC for the purposes of this analysis. Using the tigris package, I created a shapefile tibble with Wake County's census tracts. I also incorporated supplemental data by importing a file with the health service zones in Wake County, which allow me to further spatially aggregate the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## SVI file\nwake_tbl <- read.xlsx('Data/svi-data.xlsx') %>% \n  as_tibble() %>% # Convert to tibble\n  clean_names() %>% # Clean variable names\n  filter(county == \"Wake County\") # Filter to Wake County only\n\n## Wake census tracts\nwake_tracts <- tracts(\"NC\", \"Wake\")\n\n## Health service zones\nwake_service_zones <- read.xlsx('Data/health_service_zones.xlsx') %>% \n  as_tibble() %>% # Convert to tibble\n  clean_names() %>% # Clean variable names\n  mutate(across(geoid:tract, ~as.character(.x))) # Convert variables to character\n```\n:::\n\n\n\n# Clean Data\n\nSteps to clean the data included: (1) converting the indicators provided to numeric, (2) creating overall variables for Wake County's total population and housing units, (3) cleaning the location variable to only include the census tract, (4) creating a population density variable, (5) converting indicators that are counts to percents for more consistent comparison across tracts, (6) calculating a count of overcrowded housing units since it was the only indicator provided as a percent, and (7) multiplying percentages by 100 and round to 1 decimal for easier interpretation in figures to be developed.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwake_tbl_clean <- wake_tbl %>%\n  mutate(\n    # Convert variables to numeric\n    across(area_in_sq_mi:people_25_w_o_high_school_diploma, ~as.numeric(.x)),\n    \n    # Create variables for total county population and total housing units\n    total_pop = sum(population),\n    total_housing_units = sum(housing_units),\n    \n    # Clean location variable\n    location = str_extract(location, \"^[^;]+\"),\n    \n    # Create variable for population density\n    pop_density = population/area_in_sq_mi,\n    \n    # Update indicators to percents for comparison\n    ## Denominator = Population\n    perc_below_150_percent_poverty = ppl_below_150_percent_poverty/population,\n    perc_bipoc_residents = bipoc_residents/population,\n    perc_w_o_high_school_diploma = people_25_w_o_high_school_diploma/population,\n    ## Denominator = Households\n    perc_hh_no_vehicle = households_with_no_vehicle/households,\n    \n    # Calculate count of overcrowded housing units\n    overcrowded_housing_units = percent_of_overcrowded_housing_units*housing_units,\n    \n    # Multiply percentages by 100 and round to 1 decimal\n    across(starts_with(\"perc_\"), ~round((.x*100), digits = 1))\n  )\n```\n:::\n\n\n\n# Merge Clean Data and Shapefile\n\nI merged the cleaned dataset and the wake_tracts shapefile, joining by the \"GEOID\" field in the shapefile and the \"fips_code\" field in the cleaned data. Then, I merged the resulting file with the wake_service_zones shapefile to incorporate service zone data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwake_sf <- left_join(\n  wake_tracts, \n  wake_tbl_clean, \n  by = c(\"GEOID\" = \"fips_code\")) %>%\n  drop_na(starts_with(\"perc\"))\n\nwake_service_zones_sf <- left_join(\n  wake_sf,\n  wake_service_zones, \n  by = c(\"GEOID\" = \"geoid\")) %>%\n  drop_na(starts_with(\"perc\")) %>%\n  mutate(zone_name = ifelse(zone_name==\"East Central\", \"East\\nCentral\", zone_name))\n```\n:::\n\n\n\n# Analyzing Social Vulnerability Among Tracts\n\nI wanted to identify the \"most\" and \"least\" socially vulnerable communities to visualize geographic disparities in social vulnerability factors across Wake County, so **I calculated the 75th and 25th percentiles** for each of the following indicators: rates of no high school diploma (age 25+), individuals below 150% FPL, overcrowded housing, households without a vehicle, and BIPOC residents.\n\nI defined the **most socially vulnerable areas** as tracts in the **top 25%** across all 5 of the indicators: rates of no high school diploma among individuals 25 and over (\\>= *5.6%*), individuals below 150% FPL (\\>= *18.6%*), overcrowded housing units (\\>= *3%*), households without a vehicle (\\>= *6%*), and BIPOC residents (\\>= *52.6%*). Similarly, I defined the **least socially vulnerable areas** as tracts in the **bottom 25%** across all 5 indicators: rates of no high school diploma among individuals 25 and over (\\<= *1.2*%), individuals below 150% FPL (\\>= *6.5%*), overcrowded housing units (*0%*), households without a vehicle (\\<= *0.9%*), and BIPOC residents (\\<= *23.9%*).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create map caption\ncaption <- \"Source: CDC/ATSDR Social Vulnerability Index\"\n\n# Define the columns of interest\ncolumns_of_interest <- c(\n  \"perc_below_150_percent_poverty\",\n  \"perc_hh_no_vehicle\",\n  \"percent_of_overcrowded_housing_units\",\n  \"perc_w_o_high_school_diploma\",\n  \"perc_bipoc_residents\"\n)\n\n# Most Socially Vulnerable Tracts\n## Calculate the 75th percentile for each indicator\nupper_percentiles <- wake_tbl_clean %>%\n  summarise(across(all_of(columns_of_interest), ~ quantile(.x, 0.75, na.rm = TRUE)))\n\n## Identify tracts where all values are in the 75th percentile or greater\nhighest_quartile_tracts <- wake_tbl_clean %>%\n  filter(\n    perc_below_150_percent_poverty >= upper_percentiles$perc_below_150_percent_poverty &\n    perc_hh_no_vehicle >= upper_percentiles$perc_hh_no_vehicle &\n    percent_of_overcrowded_housing_units >= upper_percentiles$percent_of_overcrowded_housing_units &\n    perc_w_o_high_school_diploma >= upper_percentiles$perc_w_o_high_school_diploma &\n    perc_bipoc_residents >= upper_percentiles$perc_bipoc_residents\n  )\n\n## Merge the highest quartile tracts with the shapefile\nhighest_quartile_tracts_geo <- wake_tracts %>%\n  inner_join(highest_quartile_tracts, by = c(\"GEOID\" = \"fips_code\"))\n\n# Least Socially Vulnerable Tracts\n## Calculate the 25th percentile for each indicator\nbottom_percentiles <- wake_tbl_clean %>%\n  summarise(across(all_of(columns_of_interest), ~ quantile(.x, 0.25, na.rm = TRUE)))\n\n## Identify tracts where all values are in the 25th percentile or lower\nlowest_quartile_tracts <- wake_tbl_clean %>%\n  filter(\n    perc_below_150_percent_poverty <= bottom_percentiles$perc_below_150_percent_poverty &\n    perc_hh_no_vehicle <= bottom_percentiles$perc_hh_no_vehicle &\n    percent_of_overcrowded_housing_units <= bottom_percentiles$percent_of_overcrowded_housing_units &\n    perc_w_o_high_school_diploma <= bottom_percentiles$perc_w_o_high_school_diploma &\n    perc_bipoc_residents <= bottom_percentiles$perc_bipoc_residents\n  )\n\n## Merge the lowest quartile tracts with the shapefile\nlowest_quartile_tracts_geo <- wake_tracts %>%\n  inner_join(lowest_quartile_tracts, by = c(\"GEOID\" = \"fips_code\"))\n```\n:::\n\n\n\n# Visualizing the Most and Least Socially Vulnerable Communities in Wake County\n\nThe **most socially vulnerable areas** are census tracts in the **top 25%** for rates of no high school diploma (age 25+), individuals below 150% FPL, overcrowded housing, households without a vehicle, and BIPOC residents. The **least socially vulnerable areas** are in the **bottom 25%** for these indicators.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Create layered map with service zones, tracts, and most/least socially vulnerable areas\n## Create base map\nbase_map <- ggplot(data = wake_service_zones_sf) +\n  geom_sf(aes(geometry = geometry), fill = \"white\", color = \"gray\", size = 0.2) +\n  theme_map()\n\n## Add the most and least vulnerable tracts layer\nmap_top_tracts <- base_map +\n  geom_sf(data = highest_quartile_tracts_geo, aes(fill = \"Most Vulnerable\"), color = \"gray\", alpha = .75) +\n  geom_sf(data = lowest_quartile_tracts_geo, aes(fill = \"Least Vulnerable\"), color = \"gray\", alpha = .75) +\n  scale_fill_manual(\n    name = \"Tract-Level Social Vulnerability\",\n    values = c(\"Least Vulnerable\" = \"#2c7fb8\", \"Most Vulnerable\" = \"#edf8b1\"),\n    labels = c(\"Least Vulnerable Areas\", \"Most Vulnerable Areas\")\n  )\n\n## Add the service zones layer\nzones <- wake_service_zones_sf %>%\n  group_by(zone_name) %>%\n  summarize(geometry = st_union(geometry))\n\nmap_with_zones <- map_top_tracts +\n  geom_sf(data = zones, fill = NA, color = \"black\", size = 20)\n\n## Add the service zone label layer\nzone_centroids <- zones %>%\n  st_centroid()\n\nmap_with_labels <- map_with_zones +\n  geom_sf_text(data = zone_centroids, aes(label = zone_name), size = 3, color = \"black\", fontface = \"bold\") +\n  labs(\n    title = \"Spatial Disparities in Social Vulnerability Factors in Wake County\",\n    caption = caption) +\n  theme(\n    legend.position = \"right\",\n    legend.direction = \"vertical\",\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 10),\n    plot.title = element_text(size = 12, face = \"bold\"),\n    plot.caption = element_text(size = 10, face = \"italic\", hjust=0, vjust=1))\n\nmap_with_labels\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Key Insight\n\nWake County is divided into 8 service zones. This map shows that **the most socially vulnerable communities are clustered together**, concentrated in the East Central service zone and nearby tracts on the borders of the North Central, South Central, and West Central service zones. On the other hand, **the least socially vulnerable communities are more distinctly spread across the county** in the Northern, North Central, West, and South Central service zones. We can use this information to help inform which tracts and service zones county-level investments should go to.\n\n# Investigating Alignment Between Opportunity Zones and Socially Vulnerable Communities\n\nEstablished by Congress in 2017 through the Tax Cuts & Jobs Act, [Opportunity Zones](https://raleigh-wake.org/business-advantages/equitable-economic-development/opportunity-zones) are a nationwide incentive program to encourage long-term investment and economic growth in communities that have experienced historical disinvestment. The Opportunity Zones Program currently defines eligible census tracts as areas where the poverty rate is 20% or higher and/or family income is less than 80% of the area's median income. In Raleigh, there are [10 census tracts](https://ral.maps.arcgis.com/apps/MapJournal/index.html?appid=497bd2e832a1451f8ad2514bcba67ad8) designated as Opportunity Zones.\n\nThe shaded areas in this map are the **most socially vulnerable areas**, or census tracts in the **top 25%** for rates of no high school diploma (age 25+), individuals below 150% FPL, overcrowded housing, households without a vehicle, and BIPOC residents. Among these tracts, green areas are designated Opportunity Zones while gray areas are not.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nhighest_quartile_tracts_geo_oz <- highest_quartile_tracts_geo %>%\n  mutate(oz = ifelse(\n    NAME %in% c(\n      '540.18','527.04','540.08','527.06','524.07','509', '545', '530.09', '528.03', '528.07'\n      ), \"1\", \"0\"))\n\n# Create layered map with service zones, tracts, and most/least socially vulnerable areas\n## Create base map\nbase_map <- wake_service_zones_sf %>%\n  filter(zone_name %in% c('East\\nCentral', 'North Central', 'West Central', 'South Central')) %>%\n  ggplot() +\n  geom_sf(aes(geometry = geometry), fill = \"white\", color = \"gray\", size = 0.2) +\n  theme_map()\n\n## Add the most vulnerable tracts layer with Opportunity Zones highlighted\nmap_oz <- base_map +\n  geom_sf(data = highest_quartile_tracts_geo_oz, aes(fill = oz), color = \"black\", alpha = .75) +\n  scale_fill_manual(\n    name = \"Opportunity Zone Status\",\n    values = c(\"1\" = \"#2ca25f\", \"0\" = \"gray\"),\n    labels = c(\"Not Opportunity Zone\", \"Opportunity Zone\")\n  )\n\n## Add the service zones layer\nzones <- wake_service_zones_sf %>%\n  filter(zone_name %in% c('East\\nCentral', 'North Central', 'West Central', 'South Central', 'East Central')) %>%\n  group_by(zone_name) %>%\n  summarize(geometry = st_union(geometry))\n\nmap_with_zones <- map_oz +\n  geom_sf(data = zones, fill = NA, color = \"black\", size = 20)\n\n## Add the service zone label layer\nzone_centroids <- zones %>%\n  st_centroid()\n\nmap_with_labels <- map_with_zones +\n  geom_sf_text(data = zone_centroids, aes(label = zone_name), size = 3, color = \"black\", fontface = \"bold\") +\n  labs(\n    title = \"Opportunity Zones Among Top Socially Vulnerable Areas in Wake County\",\n    caption = \"CDC/ATSDR Social Vulnerability Index, City of Raleigh Opportunity Zones\") +\n  theme(\n    legend.position = \"right\",\n    legend.direction = \"vertical\",\n    legend.title = element_text(size = 10, face = \"bold\"),\n    legend.text = element_text(size = 10),\n    plot.title = element_text(size = 12, face = \"bold\"),\n    plot.caption = element_text(size = 10, face = \"italic\", hjust=0, vjust=1))\n\nmap_with_labels\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n## Key Insight\n\nOf the 10 tracts identified as the most socially vulnerable areas, **4** are designated Opportunity Zones by the city of Raleigh. This overlap suggests the initiative is targeting areas with high social vulnerability, but could do better. **Expanding Opportunity Zone tract eligibility beyond poverty and income measures could lead to improved social vulnerability among communities that have been historically marginalized.** Policymakers should consider additional investment incentive programs for communities with lower rates of educational attainment and higher rates of severe housing problems, for example.\n\n# Citations\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add packages used to bibliography\ncite_packages(output = \"table\", out.dir = \".\") %>% kable()\n```\n\n::: {.cell-output-display}\n\n\n|Package    |Version |Citation                                       |\n|:----------|:-------|:----------------------------------------------|\n|base       |4.4.2   |@base                                          |\n|expss      |0.11.6  |@expss                                         |\n|GGally     |2.2.1   |@GGally                                        |\n|ggmap      |4.0.0   |@ggmap                                         |\n|ggthemes   |5.1.0   |@ggthemes                                      |\n|janitor    |2.2.0   |@janitor                                       |\n|knitr      |1.48    |@knitr2014; @knitr2015; @knitr2024             |\n|labelled   |2.13.0  |@labelled                                      |\n|openxlsx   |4.2.5.2 |@openxlsx                                      |\n|rmarkdown  |2.27    |@rmarkdown2018; @rmarkdown2020; @rmarkdown2024 |\n|scales     |1.3.0   |@scales                                        |\n|sf         |1.0.19  |@sf2018; @sf2023                               |\n|tidycensus |1.6.7   |@tidycensus                                    |\n|tidyverse  |2.0.0   |@tidyverse                                     |\n|tigris     |2.1     |@tigris                                        |\n\n\n:::\n\n```{.r .cell-code}\n#knitr::kable(pkgs)\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}